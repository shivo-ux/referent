# План реализации функций кнопок "О чем статья?", "Тезисы", "Пост для Telegram"

## Общее описание

Согласно `Project.md`, приложение должно получать URL англоязычной статьи, парсить её и по нажатию соответствующей кнопки подключать AI для генерации нужного результата.

## Текущее состояние

✅ Реализовано:
- Парсинг статьи (извлечение заголовка, даты, контента)
- Базовая структура интерфейса с кнопками
- Функция перевода статьи через OpenRouter AI (как пример реализации)

⏳ Требуется реализовать:
- Функция "О чем статья?" (краткое резюме)
- Функция "Тезисы" (ключевые моменты)
- Функция "Пост для Telegram" (форматированный пост)

---

## План действий

### Этап 1: Подготовка инфраструктуры

1. **Создать универсальный API endpoint для AI-обработки**
   - Файл: `app/api/ai-process/route.ts`
   - Принимает: `{ url: string, action: 'summary' | 'theses' | 'telegram' }`
   - Логика:
     - Вызывает `/api/parse` для получения контента статьи
     - Формирует промпт в зависимости от типа действия
     - Отправляет запрос в OpenRouter AI (модель: Deepseek)
     - Возвращает результат

### Этап 2: Реализация функции "О чем статья?"

2. **Настроить промпт для резюме**
   - Системный промпт: "Ты опытный аналитик. Создай краткое резюме статьи на русском языке."
   - Пользовательский промпт: "Опиши кратко (2-3 абзаца), о чем эта статья: [контент статьи]"
   - Параметры: `temperature: 0.5` (баланс между креативностью и точностью)

3. **Обновить функцию `handleAction` в `app/page.tsx`**
   - Для действия `'summary'` вызывать `/api/ai-process` с `action: 'summary'`
   - Обработать ответ и вывести в поле результата

### Этап 3: Реализация функции "Тезисы"

4. **Настроить промпт для тезисов**
   - Системный промпт: "Ты эксперт по анализу текстов. Выдели ключевые тезисы статьи."
   - Пользовательский промпт: "Выдели 5-7 основных тезисов этой статьи в виде маркированного списка на русском языке: [контент статьи]"
   - Формат вывода: Маркированный список (bullet points)
   - Параметры: `temperature: 0.4` (более структурированный ответ)

5. **Обновить функцию `handleAction`**
   - Для действия `'theses'` вызывать `/api/ai-process` с `action: 'theses'`
   - Результат должен быть структурированным списком

### Этап 4: Реализация функции "Пост для Telegram"

6. **Настроить промпт для Telegram-поста**
   - Системный промпт: "Ты создатель контента для социальных сетей. Создай пост для Telegram на основе статьи."
   - Пользовательский промпт: "Создай пост для Telegram на основе этой статьи. Пост должен быть: интересным, информативным, с эмодзи, структурированным (заголовок, краткое содержание, призыв к действию), не более 1000 символов: [контент статьи]"
   - Формат: Текст с эмодзи, разбитый на абзацы
   - Параметры: `temperature: 0.6` (более креативный подход)

7. **Обновить функцию `handleAction`**
   - Для действия `'telegram'` вызывать `/api/ai-process` с `action: 'telegram'`
   - Улучшить отображение результата (может быть обычный текст вместо моноширинного)

### Этап 5: Оптимизация и улучшения

8. **Оптимизация промптов**
   - Уточнить промпты на основе тестирования
   - Добавить ограничения на длину текста для обработки (текущее: 8000 символов)
   - Убедиться, что промпты учитывают наличие заголовка статьи

9. **Обработка ошибок**
   - Добавить валидацию ответа от AI
   - Обработать случаи, когда контент статьи слишком длинный
   - Добавить понятные сообщения об ошибках для пользователя

10. **Улучшение UX**
    - Показывать прогресс обработки (парсинг → AI обработка)
    - Добавить форматирование результата в зависимости от типа действия
    - Для тезисов и Telegram-поста использовать обычный шрифт, для резюме - тоже

---

## Технические детали

### Структура API endpoint `/api/ai-process`

```typescript
POST /api/ai-process
Body: {
  url: string,
  action: 'summary' | 'theses' | 'telegram'
}

Response: {
  result: string, // Результат обработки AI
  original: {
    title: string | null,
    content: string | null
  }
}
```

### Конфигурация промптов

| Действие | Системный промпт | Пользовательский промпт | Temperature |
|----------|------------------|-------------------------|-------------|
| summary  | Краткое резюме статьи | "Опиши кратко (2-3 абзаца), о чем эта статья..." | 0.5 |
| theses   | Ключевые тезисы | "Выдели 5-7 основных тезисов в виде списка..." | 0.4 |
| telegram | Пост для Telegram | "Создай пост для Telegram (до 1000 символов, с эмодзи)..." | 0.6 |

### Модель AI

- **Модель**: `deepseek/deepseek-chat` (через OpenRouter)
- **API Key**: Из переменной окружения `OPENROUTER_API_KEY`
- **Endpoint**: `https://openrouter.ai/api/v1/chat/completions`

---

## Порядок реализации (пошагово)

1. ✅ Создать `/app/api/ai-process/route.ts` с базовой структурой
2. ✅ Реализовать логику парсинга статьи (использовать существующий `/api/parse`)
3. ✅ Добавить обработку действия `summary` с соответствующим промптом
4. ✅ Обновить `handleAction` в `app/page.tsx` для работы с новым endpoint
5. ✅ Протестировать функцию "О чем статья?"
6. ✅ Добавить обработку действия `theses`
7. ✅ Протестировать функцию "Тезисы"
8. ✅ Добавить обработку действия `telegram`
9. ✅ Протестировать функцию "Пост для Telegram"
10. ✅ Улучшить форматирование вывода для разных типов результатов
11. ✅ Добавить обработку ошибок и edge cases
12. ✅ Финальное тестирование всех функций

---

## Примечания

- Все функции используют одну и ту же модель Deepseek через OpenRouter
- Промпты написаны на русском языке, так как результат должен быть на русском
- Ограничение длины текста (8000 символов) применяется для экономии токенов
- При необходимости можно добавить кэширование результатов для оптимизации

